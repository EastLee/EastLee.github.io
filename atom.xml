<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Blog</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2016-05-12T07:21:46.895Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>EastLee</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>表单提交问题</title>
    <link href="http://yoursite.com/2016/05/12/form-submit/"/>
    <id>http://yoursite.com/2016/05/12/form-submit/</id>
    <published>2016-05-12T06:47:44.000Z</published>
    <updated>2016-05-12T07:21:46.895Z</updated>
    
    <content type="html">&lt;h2 id=&quot;表单提交方式&quot;&gt;&lt;a href=&quot;#表单提交方式&quot; class=&quot;headerlink&quot; title=&quot;表单提交方式&quot;&gt;&lt;/a&gt;表单提交方式&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;input[type=submit]&lt;/li&gt;
&lt;li&gt;button[type=submit]&lt;/li&gt;
&lt;li&gt;input[type=image]&lt;/li&gt;
&lt;li&gt;form对象调用submit()方法&lt;/li&gt;
&lt;li&gt;&lt;p&gt;submit事件&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;阻止表单提交&quot;&gt;&lt;a href=&quot;#阻止表单提交&quot; class=&quot;headerlink&quot; title=&quot;阻止表单提交&quot;&gt;&lt;/a&gt;阻止表单提交&lt;/h2&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;设置提交按钮disabled属性&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;调用submit事件&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;1、调用submit方法的时候不会触发submit事件，但是与之对应的有一个重置表单方法reset，调用后会触发reset事件。&lt;br&gt;2、在点击提交按钮的时候，先触发click事件，再触发submit事件&lt;br&gt;3、type=image的表单元素通过表单 elements 属性是获取不到的&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;submit事件&quot;&gt;&lt;a href=&quot;#submit事件&quot; class=&quot;headerlink&quot; title=&quot;submit事件&quot;&gt;&lt;/a&gt;submit事件&lt;/h2&gt;&lt;h3 id=&quot;demo1绑定&quot;&gt;&lt;a href=&quot;#demo1绑定&quot; class=&quot;headerlink&quot; title=&quot;demo1绑定&quot;&gt;&lt;/a&gt;demo1绑定&lt;/h3&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;myform.onsubmit = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这种方式直接返回false即可&lt;/p&gt;
&lt;h3 id=&quot;demo2绑定&quot;&gt;&lt;a href=&quot;#demo2绑定&quot; class=&quot;headerlink&quot; title=&quot;demo2绑定&quot;&gt;&lt;/a&gt;demo2绑定&lt;/h3&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;addListener&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;element, type, handler&lt;/span&gt;)&lt;/span&gt;&amp;#123;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!element) &amp;#123;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (element.addEventListener) &amp;#123;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        element.addEventListener(type, handler, &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;);  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;span class=&quot;comment&quot;&gt;//for ie  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        element.attachEvent(&lt;span class=&quot;string&quot;&gt;&quot;on&quot;&lt;/span&gt; + type, handler);  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;addListener(obj, &lt;span class=&quot;string&quot;&gt;&#39;submit&#39;&lt;/span&gt;, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;以上提交方式在ie下可以阻止表单提交，但是在ff或者chrome却不行，究其原因是addListener中的事件处理函数没有返回值，写了也白写！&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The listener parameter is a EventListener object.Object EventListener：This is an ECMAScript function reference. This method has no return value. The parameter is a Event object.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;解决方法：&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;addListener(obj, &lt;span class=&quot;string&quot;&gt;&#39;submit&#39;&lt;/span&gt;, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;e&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; e = e || &lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.event;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(e.preventDefault)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        e.preventDefault();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        e.returnValue = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;脚本处理完自己的工作后由元素处理事件，元素可以通过事件对象判断是否执行默认操作！&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;表单提交方式&quot;&gt;&lt;a href=&quot;#表单提交方式&quot; class=&quot;headerlink&quot; title=&quot;表单提交方式&quot;&gt;&lt;/a&gt;表单提交方式&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;input[type=submit]&lt;/li&gt;
&lt;li&gt;button[type=submit]&lt;/li&gt;
&lt;li&gt;input[type=image]&lt;/li&gt;
&lt;li&gt;form对象调用submit()方法&lt;/li&gt;
&lt;li&gt;&lt;p&gt;submit事件&lt;/p&gt;
    
    </summary>
    
      <category term="HTML" scheme="http://yoursite.com/categories/HTML/"/>
    
    
      <category term="form" scheme="http://yoursite.com/tags/form/"/>
    
  </entry>
  
  <entry>
    <title>PS一键切图</title>
    <link href="http://yoursite.com/2016/05/11/ps-shortCut/"/>
    <id>http://yoursite.com/2016/05/11/ps-shortCut/</id>
    <published>2016-05-11T08:47:34.000Z</published>
    <updated>2016-05-11T09:09:22.874Z</updated>
    
    <content type="html">&lt;p&gt;作为一名前端，明天都在做着重复的切图工作，如果方法不佳，会浪费大把的生命，下面小生介绍一个切图小技巧，提高一下工作效率！&lt;/p&gt;
&lt;h2 id=&quot;步骤&quot;&gt;&lt;a href=&quot;#步骤&quot; class=&quot;headerlink&quot; title=&quot;步骤&quot;&gt;&lt;/a&gt;步骤&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;点击下载&lt;a href=&quot;http://files.cnblogs.com/rangzf/%E4%B8%80%E9%94%AE%E5%88%87%E5%9B%BEby%E8%AE%A9%E5%91%A8%E9%A3%9E%EF%BC%88%E5%8F%AA%E5%8C%85%E5%90%AB%E2%80%98%E4%B8%80%E9%94%AE%E5%88%87%E5%9B%BE%E2%80%99%E5%8A%A8%E4%BD%9C%EF%BC%89.zip&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;一键切图&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;载入：菜单栏—&amp;gt;窗口—&amp;gt;动作，按照此步骤打开动作面板，点击面板右上角（见图中红框），出现下拉菜单，选择‘载入动作’，然后将刚才下载的‘一键切图动作’载入。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;img src=&quot;/2016/05/11/ps-shortCut/w704.png&quot; alt=&quot;载入&quot; title=&quot;载入&quot;&gt;&lt;/li&gt;
&lt;li&gt;选择一张psd图，选中其中一个图层，按F2，奇迹就会发生！&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;作为一名前端，明天都在做着重复的切图工作，如果方法不佳，会浪费大把的生命，下面小生介绍一个切图小技巧，提高一下工作效率！&lt;/p&gt;
&lt;h2 id=&quot;步骤&quot;&gt;&lt;a href=&quot;#步骤&quot; class=&quot;headerlink&quot; title=&quot;步骤&quot;&gt;&lt;/a&gt;步骤&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;点击下载&lt;a href=&quot;http://files.cnblogs.com/rangzf/%E4%B8%80%E9%94%AE%E5%88%87%E5%9B%BEby%E8%AE%A9%E5%91%A8%E9%A3%9E%EF%BC%88%E5%8F%AA%E5%8C%85%E5%90%AB%E2%80%98%E4%B8%80%E9%94%AE%E5%88%87%E5%9B%BE%E2%80%99%E5%8A%A8%E4%BD%9C%EF%BC%89.zip&quot;&gt;一键切图&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;载入：菜单栏—&amp;gt;窗口—&amp;gt;动作，按照此步骤打开动作面板，点击面板右上角（见图中红框），出现下拉菜单，选择‘载入动作’，然后将刚才下载的‘一键切图动作’载入。
    
    </summary>
    
      <category term="PS切图" scheme="http://yoursite.com/categories/PS%E5%88%87%E5%9B%BE/"/>
    
    
      <category term="PS" scheme="http://yoursite.com/tags/PS/"/>
    
  </entry>
  
  <entry>
    <title>ESL之config配置</title>
    <link href="http://yoursite.com/2016/05/10/esl-config/"/>
    <id>http://yoursite.com/2016/05/10/esl-config/</id>
    <published>2016-05-10T09:09:54.000Z</published>
    <updated>2016-05-10T13:29:27.490Z</updated>
    
    <content type="html">&lt;h2 id=&quot;config默认配置&quot;&gt;&lt;a href=&quot;#config默认配置&quot; class=&quot;headerlink&quot; title=&quot;config默认配置&quot;&gt;&lt;/a&gt;config默认配置&lt;/h2&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; requireConf = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    baseUrl: &lt;span class=&quot;string&quot;&gt;&#39;./&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    paths: &amp;#123;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    config: &amp;#123;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    map: &amp;#123;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    packages: [],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    waitSeconds: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    noRequests: &amp;#123;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    urlArgs: &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;所有的配置初始化在createConfIndex函数中完成&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;baseUrl&quot;&gt;&lt;a href=&quot;#baseUrl&quot; class=&quot;headerlink&quot; title=&quot;baseUrl&quot;&gt;&lt;/a&gt;baseUrl&lt;/h2&gt;&lt;p&gt;在整个源码中只有以下两处出现过：&lt;br&gt;createConfIndex对baseUrl的处理&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//处理末尾有或者没有‘/’&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;requireConf.baseUrl = requireConf.baseUrl.replace(&lt;span class=&quot;regexp&quot;&gt;/\/$/&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;) + &lt;span class=&quot;string&quot;&gt;&#39;/&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;对于baseUrl，末尾可以有“/”也可以没有！&lt;/p&gt;
&lt;p&gt;在toUrl函数中拼接模块的url&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 相对路径时，附加baseUrl(url前面不能有&quot;/&quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;regexp&quot;&gt;/^([a-z]&amp;#123;2,10&amp;#125;:\/)?\//i&lt;/span&gt;.test(url)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      url = requireConf.baseUrl + url;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在加载模块时，会把所有的要通过script标签加载define文件的url前面拼接baseUrl&lt;/p&gt;
&lt;h2 id=&quot;paths&quot;&gt;&lt;a href=&quot;#paths&quot; class=&quot;headerlink&quot; title=&quot;paths&quot;&gt;&lt;/a&gt;paths&lt;/h2&gt;&lt;p&gt;配置&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;.config(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      baseUrl: &lt;span class=&quot;string&quot;&gt;&quot;http://j2.58cdn.com.cn/m58/njs/&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      paths: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        test: &lt;span class=&quot;string&quot;&gt;&quot;pkg/house&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;([&lt;span class=&quot;string&quot;&gt;&#39;test/ershoufang_list&#39;&lt;/span&gt;], &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;pkg ershoufang_list callback&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;createConfIndex对paths的处理&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;pathsIndex = createKVSortedIndex(requireConf.paths);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//处理结果&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pathsIndex = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    k: &lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    reg: &lt;span class=&quot;regexp&quot;&gt;/^test(\/|$)/&lt;/span&gt;, &lt;span class=&quot;comment&quot;&gt;//前缀匹配&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    v: &lt;span class=&quot;string&quot;&gt;&quot;pkg/house&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;toUrl的处理&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// paths处理和匹配&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; isPathMap;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 将url中的key用pathsIndex中value替换&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;indexRetrieve(id, pathsIndex, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;value, key&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  url = url.replace(key, value);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  isPathMap = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 如果pathsIndex没有匹配，就用packagesIndex处理url&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!isPathMap) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  indexRetrieve(id, packagesIndex, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;value, key, item&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    url = url.replace(item.name, item.location);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;相当于在url中用paths的key作为模块id的一部分，而其value才是url真实的一部分，并且packages和paths是互斥的！&lt;/p&gt;
&lt;h2 id=&quot;packages&quot;&gt;&lt;a href=&quot;#packages&quot; class=&quot;headerlink&quot; title=&quot;packages&quot;&gt;&lt;/a&gt;packages&lt;/h2&gt;&lt;p&gt;配置&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;.config(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      baseUrl: &lt;span class=&quot;string&quot;&gt;&quot;http://j2.58cdn.com.cn/m58/njs/&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      packages: [&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        name: &lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        location: &lt;span class=&quot;string&quot;&gt;&quot;pkg/house&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        main: &lt;span class=&quot;string&quot;&gt;&quot;ershoufang_list&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;([&lt;span class=&quot;string&quot;&gt;&#39;test&#39;&lt;/span&gt;], &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;pkg ershoufang_list callback&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;createConfIndex对packages的处理&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;packagesIndex = [];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    each(requireConf.packages, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;packageConf&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; pkg = packageConf;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt; packageConf === &lt;span class=&quot;string&quot;&gt;&#39;string&#39;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          pkg = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            name: packageConf.split(&lt;span class=&quot;string&quot;&gt;&#39;/&#39;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            location: packageConf,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            main: &lt;span class=&quot;string&quot;&gt;&#39;main&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        pkg.location = pkg.location || pkg.name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        pkg.main = (pkg.main || &lt;span class=&quot;string&quot;&gt;&#39;main&#39;&lt;/span&gt;).replace(&lt;span class=&quot;regexp&quot;&gt;/\.js$/i&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        pkg.reg = createPrefixRegexp(pkg.name); &lt;span class=&quot;comment&quot;&gt;//前缀匹配name&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        packagesIndex.push(pkg);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    packagesIndex.sort(descSorterByKOrName);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;packagesIndex一般会有name、location、main和reg这四个属性&lt;/p&gt;
&lt;p&gt;在normalize中&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//packagesIndex中某项的name属性与moduleId相同，就将main属性拼接在moduleId之后&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    each(packagesIndex, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;packageConf&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; name = packageConf.name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (name === moduleId) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          moduleId = name + &lt;span class=&quot;string&quot;&gt;&#39;/&#39;&lt;/span&gt; + packageConf.main;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;packagesIndex的name属性与moduleId匹配时，把main属性拼接上&lt;/p&gt;
&lt;p&gt;toUrl的处理&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// paths处理和匹配&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; isPathMap;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 将url中的key用pathsIndex中value替换&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;indexRetrieve(id, pathsIndex, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;value, key&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  url = url.replace(key, value);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  isPathMap = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 如果pathsIndex没有匹配，就用packagesIndex处理url&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!isPathMap) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  indexRetrieve(id, packagesIndex, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;value, key, item&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    url = url.replace(item.name, item.location);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;如果匹配，就用packagesIndex的location属性替换url中的name部分&lt;/p&gt;
&lt;h2 id=&quot;map&quot;&gt;&lt;a href=&quot;#map&quot; class=&quot;headerlink&quot; title=&quot;map&quot;&gt;&lt;/a&gt;map&lt;/h2&gt;&lt;p&gt;配置&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;.config(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      baseUrl: &lt;span class=&quot;string&quot;&gt;&quot;http://j2.58cdn.com.cn/m58/njs/&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      map: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;pkg/house/ershoufang_list&quot;&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;mod/common&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;([&lt;span class=&quot;string&quot;&gt;&#39;pkg/house/ershoufang_list&#39;&lt;/span&gt;], &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;pkg ershoufang_list callback&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;createConfIndex中的处理&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mappingIdIndex = createKVSortedIndex(requireConf.map, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    each(mappingIdIndex, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;item&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item.v = createKVSortedIndex(item.v);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;normalize中的处理&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// mappingIdIndex=[&amp;#123;reg1:xx,k1:xx,v1:&amp;#123;reg2:xx,k2:xx,v2:xx&amp;#125;&amp;#125;]，reg1匹配baseId，reg2匹配moduleId,将moduleId中的k2用v2替换&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    indexRetrieve(baseId, mappingIdIndex, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;value&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        indexRetrieve(moduleId, value, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;mdValue, mdKey&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            moduleId = moduleId.replace(mdKey, mdValue);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;map就是paths多一层，先匹配父模块的id，再匹配子模块的id，最后替换的是子模块的id&lt;/p&gt;
&lt;h2 id=&quot;urlArgs&quot;&gt;&lt;a href=&quot;#urlArgs&quot; class=&quot;headerlink&quot; title=&quot;urlArgs&quot;&gt;&lt;/a&gt;urlArgs&lt;/h2&gt;&lt;p&gt;配置&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;.config(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    urlArgs: &lt;span class=&quot;string&quot;&gt;&#39;v=2.0.0&#39;&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// 指定所有模块的路径后参数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;.config(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    urlArgs: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        common: &lt;span class=&quot;string&quot;&gt;&#39;1.2.0&#39;&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// 为common和common下的子模块指定路径后参数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;createConfIndex中的处理&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;urlArgsIndex = createKVSortedIndex(requireConf.urlArgs);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;require.config中的处理&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (newValue) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (key === &lt;span class=&quot;string&quot;&gt;&#39;urlArgs&#39;&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt; newValue === &lt;span class=&quot;string&quot;&gt;&#39;string&#39;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          defaultUrlArgs = newValue;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在urlArgs设置为字符串时，会赋值给defaultUrlArgs&lt;/p&gt;
&lt;p&gt;toUrl中的处理&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 拼接查询字段，如果urlArgsIndex拼接了，defaultUrlArgs就不用拼接&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; isUrlArgsAppended;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    indexRetrieve(id, urlArgsIndex, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;value&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      appendUrlArgs(value);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    defaultUrlArgs &amp;amp;&amp;amp; appendUrlArgs(defaultUrlArgs);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;urlArgs主要作用是在模块的url上拼接一个查询字符串&lt;/p&gt;
&lt;h2 id=&quot;waitSeconds&quot;&gt;&lt;a href=&quot;#waitSeconds&quot; class=&quot;headerlink&quot; title=&quot;waitSeconds&quot;&gt;&lt;/a&gt;waitSeconds&lt;/h2&gt;&lt;p&gt;配置&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;.config(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    waitSeconds: &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;指定等待的秒数。超过等待时间后，如果有模块未成功加载或初始化，将抛出 MODULE_TIMEOUT 异常错误信息。&lt;/p&gt;
&lt;h2 id=&quot;noRequests&quot;&gt;&lt;a href=&quot;#noRequests&quot; class=&quot;headerlink&quot; title=&quot;noRequests&quot;&gt;&lt;/a&gt;noRequests&lt;/h2&gt;&lt;p&gt;配置&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;.config(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      baseUrl: &lt;span class=&quot;string&quot;&gt;&quot;http://j2.58cdn.com.cn/m58/njs/&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      noRequests: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;pkg/house/ershoufang_list&quot;&lt;/span&gt;: [&lt;span class=&quot;string&quot;&gt;&quot;pkg/house/ershoufang_list&quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;([&lt;span class=&quot;string&quot;&gt;&#39;pkg/house/ershoufang_list&#39;&lt;/span&gt;], &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;pkg ershoufang_list callback&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;createConfIndex中的处理&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;noRequestsIndex = createKVSortedIndex(requireConf.noRequests);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    each(noRequestsIndex, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;item&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;span class=&quot;comment&quot;&gt;//[&amp;#123;reg:xx,k:xx,v:[xx,xx]&amp;#125;]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; value = item.v;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; mapIndex = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      item.v = mapIndex;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!(value &lt;span class=&quot;keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Array&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        value = [value];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      each(value, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;meetId&lt;/span&gt;) &lt;/span&gt;&amp;#123; &lt;span class=&quot;comment&quot;&gt;//[&amp;#123;reg:xx,k:xx,v:&amp;#123;xx:1,xx:1&amp;#125;&amp;#125;]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mapIndex[meetId] = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;actualGlobalRequire函数中的处理&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;each(pureModules, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;id&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; meet;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// noRequestsIndex = //[&amp;#123;reg:xx,k:xx,v:&amp;#123;xx:1,xx:1&amp;#125;&amp;#125;]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// reg要匹配id，v值的属性还要存在一个pureModules&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            indexRetrieve(id, noRequestsIndex, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;value&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                meet = value;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (meet) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (meet[&lt;span class=&quot;string&quot;&gt;&#39;*&#39;&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                noRequestModules[id] = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                each(pureModules, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;meetId&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (meet[meetId]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    noRequestModules[id] = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        nativeRequire(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          pureModules,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123; &lt;span class=&quot;comment&quot;&gt;//require回调函数所在&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            each(normalizedIds, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;id, i&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (id == &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                normalizedIds[i] = normalize(requireId[i], baseId); &lt;span class=&quot;comment&quot;&gt;// 对有感叹号的id做处理&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            nativeRequire(normalizedIds, callback, baseId);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          baseId,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          noRequestModules&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        );&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;native中的处理&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;each(ids, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;id&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!(BUILDIN_MODULE[id] || modIs(id, MODULE_DEFINED))) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    modAddDefinedListener(id, tryFinishRequire); &lt;span class=&quot;comment&quot;&gt;//为没有达到MODULE_DEFINED的模块增加监听函数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!noRequests[id]) &amp;#123; &lt;span class=&quot;comment&quot;&gt;//若存在就不加载&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      (id.indexOf(&lt;span class=&quot;string&quot;&gt;&#39;!&#39;&lt;/span&gt;) &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; ? loadResource : loadModule)(id, baseId);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;noRequests的作用就是拒绝加载require中引入的模块&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;config默认配置&quot;&gt;&lt;a href=&quot;#config默认配置&quot; class=&quot;headerlink&quot; title=&quot;config默认配置&quot;&gt;&lt;/a&gt;config默认配置&lt;/h2&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; requireConf = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    baseUrl: &lt;span class=&quot;string&quot;&gt;&#39;./&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    paths: &amp;#123;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    config: &amp;#123;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    map: &amp;#123;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    packages: [],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    waitSeconds: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    noRequests: &amp;#123;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    urlArgs: &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;所有的配置初始化在createConfIndex函数中完成&lt;br&gt;
    
    </summary>
    
      <category term="前端模块化" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    
    
      <category term="esl" scheme="http://yoursite.com/tags/esl/"/>
    
  </entry>
  
  <entry>
    <title>ESL模块处理过程</title>
    <link href="http://yoursite.com/2016/05/10/esl-run-route/"/>
    <id>http://yoursite.com/2016/05/10/esl-run-route/</id>
    <published>2016-05-10T06:07:23.000Z</published>
    <updated>2016-05-10T13:29:33.227Z</updated>
    
    <content type="html">&lt;h2 id=&quot;ESL是什么&quot;&gt;&lt;a href=&quot;#ESL是什么&quot; class=&quot;headerlink&quot; title=&quot;ESL是什么&quot;&gt;&lt;/a&gt;ESL是什么&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/EastLee/esl&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ESL&lt;/a&gt;是一个浏览器端、符合AMD的标准加载器，适合于现代web浏览器端应用的入口与模块管理。&lt;br&gt;相比于RequireJS拥有以下优点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;体积更小&lt;/li&gt;
&lt;li&gt;性能更高&lt;/li&gt;
&lt;li&gt;更健壮&lt;/li&gt;
&lt;li&gt;不支持非浏览器端使用&lt;/li&gt;
&lt;li&gt;依赖模块用时定义&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;ESL模块加载详解&quot;&gt;&lt;a href=&quot;#ESL模块加载详解&quot; class=&quot;headerlink&quot; title=&quot;ESL模块加载详解&quot;&gt;&lt;/a&gt;ESL模块加载详解&lt;/h2&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;esl.js加载模块过程如下：&lt;br&gt;&lt;img src=&quot;/2016/05/10/esl-run-route/esl-run-route.png&quot; alt=&quot;esl run route&quot; title=&quot;esl run route&quot;&gt;&lt;/p&gt;
&lt;p&gt;1、require引入模块的入口，调用nativeRequire，在这个函数中通过tryFinishRequire绑定require的callback，并且把tryFinishRequire作为监听函数绑在入口模块上；&lt;/p&gt;
&lt;p&gt;2、nativeRequire通过loadModule加载入口js文件即define文件，并且通过onload绑定一个监听函数loadedListener；&lt;/p&gt;
&lt;p&gt;3、define函数生产出模块的id、依赖模块和callback；&lt;/p&gt;
&lt;p&gt;4、等到define文件执行完成，loadedListener会通过completePreDefine将模块数据加入到modModules中；&lt;/p&gt;
&lt;p&gt;5、最后通过modAnalyse分析依赖模块的属性以及处理url，其中会调用modAutoInvoke（核心函数）处理最后的结果，如果依赖的模块还存在没有加载的，再次统一放入nativeRequire中，循环上面的过程！&lt;/p&gt;
&lt;h2 id=&quot;核心函数modAutoInvoke分析&quot;&gt;&lt;a href=&quot;#核心函数modAutoInvoke分析&quot; class=&quot;headerlink&quot; title=&quot;核心函数modAutoInvoke分析&quot;&gt;&lt;/a&gt;核心函数modAutoInvoke分析&lt;/h2&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//核心函数 递归设置所有模块状态为3，递归执行所有invokeFactory&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;modAutoInvoke&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; id &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; autoDefineModules) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      modUpdatePreparedState(id); &lt;span class=&quot;comment&quot;&gt;//一次性设置有依赖关系的模块为状态3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      modTryInvokeFactory(id);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;autoDefineModules数组存放着作为入口的模块；&lt;/li&gt;
&lt;li&gt;modUpdatePreparedState的作用：采用递归遍历所有模块，检测依赖的模块是否都是状态3，如果是，autoDefineModules中对应的模块状态可以设置为3，如果不是，则不能设置为3；&lt;/li&gt;
&lt;li&gt;modTryInvokeFactory的作用是在autoDefineModules中模块状态达到3时，执行InvokeFactory；&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//invokeFactory中的两段代码&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    each(&lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.factoryDeps, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;dep&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; depId = dep.absId;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!BUILDIN_MODULE[depId]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          modTryInvokeFactory(depId); &lt;span class=&quot;comment&quot;&gt;//递归执行依赖模块的invokeFactory&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!modIs(depId, MODULE_DEFINED)) &amp;#123; &lt;span class=&quot;comment&quot;&gt;//所有依赖的模块必须达到MODULE_DEFINED&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            factoryReady = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        factoryDeps.push(depId); &lt;span class=&quot;comment&quot;&gt;//达到MODULE_DEFINED状态的模块被推入factoryDeps中&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//所有依赖的模块必须达到MODULE_DEFINED就可以执行下面的代码&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (factoryReady) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; args = modGetModulesExports( &lt;span class=&quot;comment&quot;&gt;//依赖模块的输出&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          factoryDeps, &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;: &lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.require,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            exports: &lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;: &lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; factory = &lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.factory;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; exports = &lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt; factory === &lt;span class=&quot;string&quot;&gt;&#39;function&#39;&lt;/span&gt; ? factory.apply(global, args) : factory;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (exports != &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports = exports;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.invokeFactory = &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (ex) &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      modDefined(id); &lt;span class=&quot;comment&quot;&gt;//设置为状态4,执行监听函数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;以上是invokeFactory中的两段代码，这个函数的作用就是输出模块的执行结果，但是在输出自身之前必须通过modTryInvokeFactory递归所有依赖的模块，这些依赖的模块也都必须输出执行结果，赋值在exports中，供父模块调用！&lt;/p&gt;
&lt;h2 id=&quot;核心函数modAutoInvoke调用&quot;&gt;&lt;a href=&quot;#核心函数modAutoInvoke调用&quot; class=&quot;headerlink&quot; title=&quot;核心函数modAutoInvoke调用&quot;&gt;&lt;/a&gt;核心函数modAutoInvoke调用&lt;/h2&gt;&lt;p&gt;在整个源文件中，调用modAutoInvoke主要有两处，一个是modAnalyse最后执行，在当前模块分析完毕，状态达到2时调用，另外一处是nativeRequire中！核心思想就是在每处理一个模块，都要从入口模块递归依赖的所有模块，以达到一旦所有模块准备就绪，就可以执行require的callback函数！&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/EastLee/JsModule/tree/master/esl&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;demo&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ESL是什么&quot;&gt;&lt;a href=&quot;#ESL是什么&quot; class=&quot;headerlink&quot; title=&quot;ESL是什么&quot;&gt;&lt;/a&gt;ESL是什么&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/EastLee/esl&quot;&gt;ESL&lt;/a&gt;是一个浏览器端、符合AMD的标准加载器，适合于现代web浏览器端应用的入口与模块管理。&lt;br&gt;相比于RequireJS拥有以下优点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;体积更小&lt;/li&gt;
&lt;li&gt;性能更高&lt;/li&gt;
&lt;li&gt;更健壮&lt;/li&gt;
&lt;li&gt;不支持非浏览器端使用&lt;/li&gt;
&lt;li&gt;依赖模块用时定义&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;ESL模块加载详解&quot;&gt;&lt;a href=&quot;#ESL模块加载详解&quot; class=&quot;headerlink&quot; title=&quot;ESL模块加载详解&quot;&gt;&lt;/a&gt;ESL模块加载详解&lt;/h2&gt;
    
    </summary>
    
      <category term="前端模块化" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    
    
      <category term="esl" scheme="http://yoursite.com/tags/esl/"/>
    
  </entry>
  
  <entry>
    <title>移动端之webp图片</title>
    <link href="http://yoursite.com/2016/04/27/image-to-webp/"/>
    <id>http://yoursite.com/2016/04/27/image-to-webp/</id>
    <published>2016-04-27T13:38:17.000Z</published>
    <updated>2016-05-07T09:05:33.593Z</updated>
    
    <content type="html">&lt;h2 id=&quot;webp是什么？&quot;&gt;&lt;a href=&quot;#webp是什么？&quot; class=&quot;headerlink&quot; title=&quot;webp是什么？&quot;&gt;&lt;/a&gt;&lt;a href=&quot;http://baike.baidu.com/link?url=tL9ztrug4h__GQfPznbD0O4-6iDZ5eLEsXdHZ-3crUE0GTcwmwXPtZi4Yvu4P4H2iGq4ru9XNBPG21zYm9FHqa&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;webp是什么？&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;WebP格式，谷歌（google）开发的一种旨在加快图片加载速度的图片格式。图片压缩体积大约只有JPEG的2/3，并能节省大量的服务器带宽资源和数据空间。Facebook Ebay等知名网站已经开始测试并使用WebP格式。但WebP是一种有损压缩。相较编码JPEG文件，编码同样质量的WebP文件需要占用更多的计算资源。&lt;/p&gt;
&lt;h2 id=&quot;目前使用情况&quot;&gt;&lt;a href=&quot;#目前使用情况&quot; class=&quot;headerlink&quot; title=&quot;目前使用情况&quot;&gt;&lt;/a&gt;目前使用情况&lt;/h2&gt;&lt;p&gt;国外的网站：Youtube、Facebook.etc&lt;br&gt;国内的网站：腾讯、淘宝、美团等&lt;br&gt; &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;webp兼容性&quot;&gt;&lt;a href=&quot;#webp兼容性&quot; class=&quot;headerlink&quot; title=&quot;webp兼容性&quot;&gt;&lt;/a&gt;webp兼容性&lt;/h2&gt;&lt;h3 id=&quot;支持&quot;&gt;&lt;a href=&quot;#支持&quot; class=&quot;headerlink&quot; title=&quot;支持&quot;&gt;&lt;/a&gt;支持&lt;/h3&gt;&lt;p&gt;chrome opera&lt;br&gt;4s uc&lt;br&gt;5 uc&lt;br&gt;5s uc&lt;br&gt;6 uc&lt;br&gt;6s uc&lt;br&gt;华为荣耀6 qq内置浏览器 微信 uc 自带浏览器&lt;br&gt;魅族 微信 uc 自带浏览器&lt;br&gt;三星（Galay S4） uc 自带浏览器 QQ浏览器&lt;br&gt;红米1s（andr4.3） uc QQ浏览器-v6.4.1 自带浏览器&lt;/p&gt;
&lt;h3 id=&quot;不支持&quot;&gt;&lt;a href=&quot;#不支持&quot; class=&quot;headerlink&quot; title=&quot;不支持&quot;&gt;&lt;/a&gt;不支持&lt;/h3&gt;&lt;p&gt;58app-v6.5.7&lt;br&gt;4s safari&lt;br&gt;5 safari&lt;br&gt;5s safari&lt;br&gt;6 safari&lt;br&gt;6s safari&lt;br&gt;5s qq内置浏览器&lt;br&gt;6 qq内置浏览器&lt;br&gt;6s qq内置浏览器&lt;br&gt;QQ浏览器-v6.0&lt;br&gt;QQ浏览器-v6.4&lt;br&gt;5微信&lt;br&gt;5s微信&lt;br&gt;6微信&lt;br&gt;6s微信&lt;br&gt;5s 高速浏览器&lt;/p&gt;
&lt;h2 id=&quot;如何转换&quot;&gt;&lt;a href=&quot;#如何转换&quot; class=&quot;headerlink&quot; title=&quot;如何转换&quot;&gt;&lt;/a&gt;如何转换&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://zhitu.isux.us/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;智图&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://isparta.github.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;iSparta&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://storage.googleapis.com/downloads.webmproject.org/releases/webp/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;libwebp&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;如何使用&quot;&gt;&lt;a href=&quot;#如何使用&quot; class=&quot;headerlink&quot; title=&quot;如何使用&quot;&gt;&lt;/a&gt;如何使用&lt;/h2&gt;&lt;h3 id=&quot;js检测，准备两套图片路径&quot;&gt;&lt;a href=&quot;#js检测，准备两套图片路径&quot; class=&quot;headerlink&quot; title=&quot;js检测，准备两套图片路径&quot;&gt;&lt;/a&gt;js检测，准备两套图片路径&lt;/h3&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; kTestImages = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    lossy: &lt;span class=&quot;string&quot;&gt;&quot;UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    lossless: &lt;span class=&quot;string&quot;&gt;&quot;UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    alpha: &lt;span class=&quot;string&quot;&gt;&quot;UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    animation: &lt;span class=&quot;string&quot;&gt;&quot;UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; img = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Image();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;img.onload = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; result = (img.width &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;amp;&amp;amp; (img.height &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    callback(feature, result);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;img.onerror = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    callback(feature, &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;img.src = &lt;span class=&quot;string&quot;&gt;&quot;data:image/webp;base64,&quot;&lt;/span&gt; + kTestImages[feature];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;使用webp-js&quot;&gt;&lt;a href=&quot;#使用webp-js&quot; class=&quot;headerlink&quot; title=&quot;使用webp.js&quot;&gt;&lt;/a&gt;使用webp.js&lt;/h3&gt;&lt;p&gt;插件将会捕捉页面中使用WebP格式的img元素，并用Flash进行替换。图像的解码及显示都在Flash中完成，因此目前版本对CSS设置的背景图片无效。&lt;br&gt;当然，作为JPEG格式的替换，只有对较大的图像使用才有意义，否则过多的解码将消耗大量的资源。&lt;br&gt;3、用html5中提供的picture元素选择图片格式（浏览器支持的情况不好）&lt;/p&gt;
&lt;h3 id=&quot;server-response（Accept和varry）&quot;&gt;&lt;a href=&quot;#server-response（Accept和varry）&quot; class=&quot;headerlink&quot; title=&quot;server-response（Accept和varry）&quot;&gt;&lt;/a&gt;server-response（Accept和varry）&lt;/h3&gt;&lt;h4 id=&quot;Accept&quot;&gt;&lt;a href=&quot;#Accept&quot; class=&quot;headerlink&quot; title=&quot;Accept&quot;&gt;&lt;/a&gt;Accept&lt;/h4&gt;&lt;p&gt;iphone4s&lt;br&gt;uc无Accept请求头&lt;br&gt;Safari Accept:*/*&lt;br&gt;微信 Accept:*/*&lt;br&gt;QQ浏览器-v6.4 Accept:*/*&lt;br&gt;小米4&lt;br&gt;uc：Accept:image/webp&lt;br&gt;自带浏览器：Accept:image/webp&lt;br&gt;chrome：Accept:image/webp&lt;br&gt;QQ浏览器：Accept:image/webp&lt;br&gt;并不是所有的请求头都包含images/webp 目前只有opera有&lt;/p&gt;
&lt;h4 id=&quot;varry&quot;&gt;&lt;a href=&quot;#varry&quot; class=&quot;headerlink&quot; title=&quot;varry&quot;&gt;&lt;/a&gt;varry&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;(client)  &amp;gt;  Accept: image/jpeg, image/png, image/mif&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(server) &amp;gt;  Content-Type: image/mif&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;gt;  Vary: Accept&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;gt;  (object)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;优势&quot;&gt;&lt;a href=&quot;#优势&quot; class=&quot;headerlink&quot; title=&quot;优势&quot;&gt;&lt;/a&gt;优势&lt;/h2&gt;&lt;p&gt;WebP is a new image format that provides lossless and lossy compression for images on the web. WebP lossless images are 26% smaller in size compared to PNGs. WebP lossy images are 25-34% smaller in size compared to JPEG images at equivalent SSIM index. WebP supports lossless transparency (also known as alpha channel) with just 22% additional bytes. Transparency is also supported with lossy compression and typically provides 3x smaller file sizes compared to PNG when lossy compression is acceptable for the red/green/blue color channels.&lt;/p&gt;
&lt;h2 id=&quot;参考文献：&quot;&gt;&lt;a href=&quot;#参考文献：&quot; class=&quot;headerlink&quot; title=&quot;参考文献：&quot;&gt;&lt;/a&gt;参考文献：&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://isux.tencent.com/introduction-of-webp.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;WebP 探寻之路&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developers.google.com/speed/webp/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;A new image format for the Web&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://www.igvita.com/2012/12/18/deploying-new-image-formats-on-the-web/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Deploying New Image Formats on the Web&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;How To Reduce Image Size With WebP Automagically&quot;&gt;How To Reduce Image Size With WebP Automagically&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.etherdream.com/WebP/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;让你的页面支持WebP图像&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;webp是什么？&quot;&gt;&lt;a href=&quot;#webp是什么？&quot; class=&quot;headerlink&quot; title=&quot;webp是什么？&quot;&gt;&lt;/a&gt;&lt;a href=&quot;http://baike.baidu.com/link?url=tL9ztrug4h__GQfPznbD0O4-6iDZ5eLEsXdHZ-3crUE0GTcwmwXPtZi4Yvu4P4H2iGq4ru9XNBPG21zYm9FHqa&quot;&gt;webp是什么？&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;WebP格式，谷歌（google）开发的一种旨在加快图片加载速度的图片格式。图片压缩体积大约只有JPEG的2/3，并能节省大量的服务器带宽资源和数据空间。Facebook Ebay等知名网站已经开始测试并使用WebP格式。但WebP是一种有损压缩。相较编码JPEG文件，编码同样质量的WebP文件需要占用更多的计算资源。&lt;/p&gt;
&lt;h2 id=&quot;目前使用情况&quot;&gt;&lt;a href=&quot;#目前使用情况&quot; class=&quot;headerlink&quot; title=&quot;目前使用情况&quot;&gt;&lt;/a&gt;目前使用情况&lt;/h2&gt;&lt;p&gt;国外的网站：Youtube、Facebook.etc&lt;br&gt;国内的网站：腾讯、淘宝、美团等&lt;br&gt;
    
    </summary>
    
      <category term="移动端性能优化" scheme="http://yoursite.com/categories/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
    
      <category term="性能优化" scheme="http://yoursite.com/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>viewport</title>
    <link href="http://yoursite.com/2016/04/25/viewport/"/>
    <id>http://yoursite.com/2016/04/25/viewport/</id>
    <published>2016-04-25T13:48:12.219Z</published>
    <updated>2016-05-07T08:47:38.848Z</updated>
    
    <content type="html">&lt;h2 id=&quot;viewport的概念&quot;&gt;&lt;a href=&quot;#viewport的概念&quot; class=&quot;headerlink&quot; title=&quot;viewport的概念&quot;&gt;&lt;/a&gt;viewport的概念&lt;/h2&gt;&lt;h3 id=&quot;layout-viewport&quot;&gt;&lt;a href=&quot;#layout-viewport&quot; class=&quot;headerlink&quot; title=&quot;layout viewport&quot;&gt;&lt;/a&gt;layout viewport&lt;/h3&gt;&lt;p&gt;通俗的讲，移动设备上的viewport就是设备的屏幕上能用来显示我们的网页的那一块区域，在具体一点，就是浏览器上(也可能是一个app中的webview)用来显示网页的那部分区域，但viewport又不局限于浏览器可视区域的大小，它可能比浏览器的可视区域要大，也可能比浏览器的可视区域要小。在默认情况下，一般来讲，移动设备上的viewport都是要大于浏览器可视区域的，这是因为考虑到移动设备的分辨率相对于桌面电脑来说都比较小，所以为了能在移动设备上正常显示那些传统的为桌面浏览器设计的网站，移动设备上的浏览器都会把自己默认的viewport设为980px或1024px（也可能是其它值，这个是由设备自己决定的），但带来的后果就是浏览器会出现横向滚动条，因为浏览器可视区域的宽度是比这个默认的viewport的宽度要小的。下图是一些设备上浏览器的默认viewport的宽度。&lt;img src=&quot;/2016/04/25/viewport/icon1.png&quot; alt=&quot;icon1.png&quot; title=&quot;&quot;&gt;这个layout viewport的宽度可以通过 document.documentElement.clientWidth 来获取。&lt;br&gt; &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;visual-viewport&quot;&gt;&lt;a href=&quot;#visual-viewport&quot; class=&quot;headerlink&quot; title=&quot;visual viewport&quot;&gt;&lt;/a&gt;visual viewport&lt;/h3&gt;&lt;p&gt;它是在不同的缩放（initial-scale）情况下浏览器可视区域的大小（需要多少css像素填充），visual viewport的宽度可以通过window.innerWidth 来获取，但在Android 2, Oprea mini 和 UC 8中无法正确获取。&lt;/p&gt;
&lt;h3 id=&quot;ideal-viewport&quot;&gt;&lt;a href=&quot;#ideal-viewport&quot; class=&quot;headerlink&quot; title=&quot;ideal viewport&quot;&gt;&lt;/a&gt;ideal viewport&lt;/h3&gt;&lt;p&gt;这个viewport可以理解为最适合当前机型的viewport。不同的手机的可能拥有不同的ideal viewport,一般iphone手机都是320px，但是安卓设备就比较复杂了，有320px的，有360px的，有384px的等等，关于不同的设备ideal viewport的宽度都为多少，可以到&lt;a href=&quot;http://viewportsizes.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://viewportsizes.com&lt;/a&gt;去查看一下，里面收集了众多设备的理想宽度。&lt;/p&gt;
&lt;h2 id=&quot;像素的理解&quot;&gt;&lt;a href=&quot;#像素的理解&quot; class=&quot;headerlink&quot; title=&quot;像素的理解&quot;&gt;&lt;/a&gt;像素的理解&lt;/h2&gt;&lt;h3 id=&quot;物理像素-physical-pixel&quot;&gt;&lt;a href=&quot;#物理像素-physical-pixel&quot; class=&quot;headerlink&quot; title=&quot;物理像素(physical pixel)&quot;&gt;&lt;/a&gt;物理像素(physical pixel)&lt;/h3&gt;&lt;p&gt;一个物理像素是显示器(手机屏幕)上最小的物理显示单元，在操作系统的调度下，每一个设备像素都有自己的颜色值和亮度值。&lt;/p&gt;
&lt;h3 id=&quot;设备独立像素-density-independent-pixel&quot;&gt;&lt;a href=&quot;#设备独立像素-density-independent-pixel&quot; class=&quot;headerlink&quot; title=&quot;设备独立像素(density-independent pixel)&quot;&gt;&lt;/a&gt;设备独立像素(density-independent pixel)&lt;/h3&gt;&lt;p&gt;设备独立像素(也叫密度无关像素)，可以认为是计算机坐标系统中得一个点，这个点代表一个可以由程序使用的虚拟像素(比如: css像素)，然后由相关系统转换为物理像素。&lt;/p&gt;
&lt;h3 id=&quot;设备像素比-device-pixel-ratio&quot;&gt;&lt;a href=&quot;#设备像素比-device-pixel-ratio&quot; class=&quot;headerlink&quot; title=&quot;设备像素比(device pixel ratio )&quot;&gt;&lt;/a&gt;设备像素比(device pixel ratio )&lt;/h3&gt;&lt;p&gt;定义了物理像素和设备独立像素的对应关系，它的值可以按如下的公式的得到：&lt;/p&gt;
&lt;p&gt;设备像素比 = 物理像素 / 设备独立像素 // 在某一方向上，x方向或者y方向&lt;/p&gt;
&lt;p&gt;在js中，dpr = window.devicePixelRatio&lt;/p&gt;
&lt;p&gt;在css中，可以通过-webkit-device-pixel-ratio，-webkit-min-device-pixel-ratio和 -webkit-max-device-pixel-ratio进行媒体查询，对不同dpr的设备，做一些样式适配(这里只针对webkit内核的浏览器和webview)。&lt;/p&gt;
&lt;p&gt;综合上面几个概念，一起举例说明下：&lt;/p&gt;
&lt;p&gt;以iphone6为例：设备宽高为375×667，可以理解为设备独立像素(或css像素)。&lt;br&gt;dpr为2，根据上面的计算公式，其物理像素就应该×2，为750×1334。&lt;img src=&quot;/2016/04/25/viewport/icon2.gif&quot; alt=&quot;icon2.gif&quot; title=&quot;&quot;&gt;在css像素大小不变的情况下，普通屏幕下，1个css像素 对应 1个物理像素(1:1)，retina屏幕下，1个css像素对应 4个物理像素(1:4)。&lt;/p&gt;
&lt;h2 id=&quot;meta-viewport详解&quot;&gt;&lt;a href=&quot;#meta-viewport详解&quot; class=&quot;headerlink&quot; title=&quot;meta.viewport详解&quot;&gt;&lt;/a&gt;meta.viewport详解&lt;/h2&gt;&lt;h3 id=&quot;几个概念&quot;&gt;&lt;a href=&quot;#几个概念&quot; class=&quot;headerlink&quot; title=&quot;几个概念&quot;&gt;&lt;/a&gt;几个概念&lt;/h3&gt;&lt;p&gt;一般在做移动端页面时，会把&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot;&gt;这行代码复制到页面中。该meta标签的作用是让当前viewport的宽度等于设备的宽度，同时不允许用户对其进行缩放。一般，width设置layout viewport 的宽度，为一个正整数，或字符串”width-device”；initial-scale 设置页面的初始缩放值，为一个数字，可以带小数；minimum-scale允许用户的最小缩放值，为一个数字，可以带小数；maximum-scale    允许用户的最大缩放值，为一个数字，可以带小数；user-scalable    是否允许用户进行缩放，值为”no”或”yes”, no 代表不允许，yes代表允许。当然还可以设置其他的值，用逗号隔开就可以。&lt;/p&gt;
&lt;h3 id=&quot;width和initial-scale在移动端页面中的作用&quot;&gt;&lt;a href=&quot;#width和initial-scale在移动端页面中的作用&quot; class=&quot;headerlink&quot; title=&quot;width和initial-scale在移动端页面中的作用&quot;&gt;&lt;/a&gt;width和initial-scale在移动端页面中的作用&lt;/h3&gt;&lt;p&gt;（1）通过width=device-width，所有浏览器都能把当前的viewport宽度变成ideal viewport的宽度，但要注意的是，在iphone和ipad上，无论是竖屏还是横屏，宽度都是竖屏时ideal viewport的宽度。&lt;br&gt;（2）initial-scale的缩放是相对于ideal viewport来进行缩放的，当对ideal viewport进行100%的缩放，也就是缩放值为1的时候，得到的就是ideal viewport&lt;br&gt;（3）ideal viewport的值会取width和initial-scale两个中较大的那个值&lt;/p&gt;
&lt;h3 id=&quot;关于initial-scale的缩放&quot;&gt;&lt;a href=&quot;#关于initial-scale的缩放&quot; class=&quot;headerlink&quot; title=&quot;关于initial-scale的缩放&quot;&gt;&lt;/a&gt;关于initial-scale的缩放&lt;/h3&gt;&lt;p&gt;initial-scale是对页面就行缩放（个人理解就是缩放单位css像素的大小），测试如下，在meta中去掉width这一项，visual viewport得出如下数据：&lt;img src=&quot;/2016/04/25/viewport/icon3.png&quot; alt=&quot;This is an example image&quot; title=&quot;This is an example image&quot;&gt;从上图可以看出，在屏幕宽度不变的情况下，当initial-scale变小，预示着css像素变小，导致填充整个屏幕需要的css像素就会变多。因此，我们可以得出一个公式：visual viewport宽度 = ideal viewport宽度 / 当前缩放值&lt;/p&gt;
&lt;h3 id=&quot;关于width&quot;&gt;&lt;a href=&quot;#关于width&quot; class=&quot;headerlink&quot; title=&quot;关于width&quot;&gt;&lt;/a&gt;关于width&lt;/h3&gt;&lt;p&gt;去掉initial-scale，测试width。当width=160时，&lt;img src=&quot;/2016/04/25/viewport/icon4.png&quot; alt=&quot;This is an example image&quot; title=&quot;This is an example image&quot;&gt;这是因为有些元素把宽高都写死了，此时initial-scale=2，元素都变为原来的2倍，所以导致页面很挤。当width=1280时，&lt;img src=&quot;/2016/04/25/viewport/icon5.png&quot; alt=&quot;This is an example image&quot; title=&quot;This is an example image&quot;&gt;这是因为有些元素把宽高都写死了，此时initial-scale=2，元素都变为原来的0.25倍，所以导致页面的元素很小。&lt;/p&gt;
&lt;h3 id=&quot;结论&quot;&gt;&lt;a href=&quot;#结论&quot; class=&quot;headerlink&quot; title=&quot;结论&quot;&gt;&lt;/a&gt;结论&lt;/h3&gt;&lt;p&gt;在iphone和ipad上，无论你给viewport设的宽的是多少，如果没有指定默认的缩放值，则iphone和ipad会自动计算这个缩放值，以达到当前页面不会出现横向滚动条(或者说viewport的宽度就是屏幕的宽度)的目的。安卓设备上的initial-scale默认值好像没有方法能够得到，或者就是干脆它就没有默认值，一定要你显示的写出来这个东西才会起作用！&lt;/p&gt;
&lt;h2 id=&quot;利用meta-viewport对多屏适配布局&quot;&gt;&lt;a href=&quot;#利用meta-viewport对多屏适配布局&quot; class=&quot;headerlink&quot; title=&quot;利用meta.viewport对多屏适配布局&quot;&gt;&lt;/a&gt;利用meta.viewport对多屏适配布局&lt;/h2&gt;&lt;h3 id=&quot;retina下，border-1px问题&quot;&gt;&lt;a href=&quot;#retina下，border-1px问题&quot; class=&quot;headerlink&quot; title=&quot;retina下，border: 1px问题&quot;&gt;&lt;/a&gt;retina下，border: 1px问题&lt;/h3&gt;&lt;p&gt;经常border：1px在不同手机上的宽度不一样，如下：&lt;img src=&quot;/2016/04/25/viewport/icon6.jpg&quot; alt=&quot;This is an example image&quot; title=&quot;This is an example image&quot;&gt;上图中，对于一条1px宽的直线，它们在屏幕上的物理尺寸(灰色区域)的确是相同的，不同的其实是屏幕上最小的物理显示单元，即物理像素，所以对于一条直线，iphone5它能显示的最小宽度其实是图中的红线圈出来的灰色区域，用css来表示，理论上说是0.5px。所以，设计师想要的retina下border:1px;，其实就是1物理像素宽，对于css而言，可以认为是border: 0.5px;，这是retina下(dpr=2)下能显示的最小单位。&lt;/p&gt;
&lt;h3 id=&quot;多屏适配布局&quot;&gt;&lt;a href=&quot;#多屏适配布局&quot; class=&quot;headerlink&quot; title=&quot;多屏适配布局&quot;&gt;&lt;/a&gt;多屏适配布局&lt;/h3&gt;&lt;p&gt;移动端布局，为了适配各种大屏手机，目前最好用的方案莫过于使用相对单位rem。&lt;br&gt;rem = document.documentElement.clientWidth * dpr / 10 javascript方式，通过上面的公式，计算出基准值rem，然后写入样式。&lt;/p&gt;
&lt;p&gt;以下是淘宝的代码：&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;doc, win&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; docEl = doc.documentElement,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    resizeEvt = &lt;span class=&quot;string&quot;&gt;&#39;orientationchange&#39;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt; ? &lt;span class=&quot;string&quot;&gt;&#39;orientationchange&#39;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&#39;resize&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    recalc = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; clientWidth = docEl.clientWidth;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!clientWidth) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      docEl.style.fontSize = &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt; * (clientWidth / &lt;span class=&quot;number&quot;&gt;320&lt;/span&gt;) + &lt;span class=&quot;string&quot;&gt;&#39;px&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!doc.addEventListener) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  win.addEventListener(resizeEvt, recalc, &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  doc.addEventListener(&lt;span class=&quot;string&quot;&gt;&#39;DOMContentLoaded&#39;&lt;/span&gt;, recalc, &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)(&lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看出，他们也仅仅按照手机屏幕的宽度在做适配，没有动用dpr和scale，个人认为这两个必须同时运用，页面才会在理想情况下展现！&lt;/p&gt;
&lt;p&gt;一般方法大概如下：&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; dpr, rem, scale;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; docEl = &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.documentElement;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; fontEl = &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.createElement(&lt;span class=&quot;string&quot;&gt;&#39;style&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; metaEl = &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.querySelector(&lt;span class=&quot;string&quot;&gt;&#39;meta[name=&quot;viewport&quot;]&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dpr = win.devicePixelRatio || &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;scale = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; / dpr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem = docEl.clientWidth * dpr / &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 设置viewport，进行缩放，达到高清效果&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;metaEl.setAttribute(&lt;span class=&quot;string&quot;&gt;&#39;content&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;width=&#39;&lt;/span&gt; + dpr * docEl.clientWidth + &lt;span class=&quot;string&quot;&gt;&#39;,initial-scale=&#39;&lt;/span&gt; + scale + &lt;span class=&quot;string&quot;&gt;&#39;,maximum-scale=&#39;&lt;/span&gt; + scale + &lt;span class=&quot;string&quot;&gt;&#39;, minimum-scale=&#39;&lt;/span&gt; + scale + &lt;span class=&quot;string&quot;&gt;&#39;,user-scalable=no&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 设置data-dpr属性，留作的css hack之用&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;docEl.setAttribute(&lt;span class=&quot;string&quot;&gt;&#39;data-dpr&#39;&lt;/span&gt;, dpr);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 动态写入样式&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;docEl.firstElementChild.appendChild(fontEl);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fontEl.innerHTML = &lt;span class=&quot;string&quot;&gt;&#39;html&amp;#123;font-size:&#39;&lt;/span&gt; + rem + &lt;span class=&quot;string&quot;&gt;&#39;px!important;&amp;#125;&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 给js调用的，某一dpr下rem和px之间的转换函数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.rem2px = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;v&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    v = &lt;span class=&quot;built_in&quot;&gt;parseFloat&lt;/span&gt;(v);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; v * rem;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.px2rem: &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;v&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    v = &lt;span class=&quot;built_in&quot;&gt;parseFloat&lt;/span&gt;(v);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; v / rem;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.dpr = dpr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.rem = rem;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;以上设置是为了保证，1个css像素占据一个物理像素。如果有一个区块，在psd文件中量出：宽高750×300px的div，那么如何转换成rem单位呢？如果scale是1，对于iphone6来说就是取一半，如果scale是0.5，量出多少是多少，换句话说就是设计稿的宽度W=docEl.clientWidth * dpr，对于不符合的设计稿，计算公式如下：&lt;img src=&quot;/2016/04/25/viewport/icon7.jpg&quot; alt=&quot;This is an example image&quot; title=&quot;This is an example image&quot;&gt;我们现在写页面参考的机型一般是iphone4以上，dpr一般都是2，所以按照以上写法其实只有viewport的宽度在起作用，但是如果遇到宽度和dpr都不一样的时候，两者的倍数都会起作用，如果遇到iphone3这样的，宽度不变而dpr变化的，它上面的元素就会比iphone4要小，遇到这样的机型，如果不改变scale，样式有可能出问题！&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;viewport的概念&quot;&gt;&lt;a href=&quot;#viewport的概念&quot; class=&quot;headerlink&quot; title=&quot;viewport的概念&quot;&gt;&lt;/a&gt;viewport的概念&lt;/h2&gt;&lt;h3 id=&quot;layout-viewport&quot;&gt;&lt;a href=&quot;#layout-viewport&quot; class=&quot;headerlink&quot; title=&quot;layout viewport&quot;&gt;&lt;/a&gt;layout viewport&lt;/h3&gt;&lt;p&gt;通俗的讲，移动设备上的viewport就是设备的屏幕上能用来显示我们的网页的那一块区域，在具体一点，就是浏览器上(也可能是一个app中的webview)用来显示网页的那部分区域，但viewport又不局限于浏览器可视区域的大小，它可能比浏览器的可视区域要大，也可能比浏览器的可视区域要小。在默认情况下，一般来讲，移动设备上的viewport都是要大于浏览器可视区域的，这是因为考虑到移动设备的分辨率相对于桌面电脑来说都比较小，所以为了能在移动设备上正常显示那些传统的为桌面浏览器设计的网站，移动设备上的浏览器都会把自己默认的viewport设为980px或1024px（也可能是其它值，这个是由设备自己决定的），但带来的后果就是浏览器会出现横向滚动条，因为浏览器可视区域的宽度是比这个默认的viewport的宽度要小的。下图是一些设备上浏览器的默认viewport的宽度。&lt;img src=&quot;/2016/04/25/viewport/icon1.png&quot; alt=&quot;icon1.png&quot; title=&quot;&quot;&gt;这个layout viewport的宽度可以通过 document.documentElement.clientWidth 来获取。&lt;br&gt;
    
    </summary>
    
      <category term="HTML" scheme="http://yoursite.com/categories/HTML/"/>
    
    
      <category term="html" scheme="http://yoursite.com/tags/html/"/>
    
  </entry>
  
</feed>
